2018-9-18：

## web 1: http 基础及客户端和服务器简单套路

1. http 协议的格式。protocol、path、port、query。

2. socket 客户端套路

```
# 新建连接
s = socket.socket()
# 连接域名和端口
s.connect((host, port))
# ip, port = s.getsockname()
# 构造一个请求
http_request = 'GET / HTTP/1.1\r\nHost: {}\r\n\r\n'.format(host)
# 把请求从 str 格式转换成 bytes 类型
request = http_request.encode('utf-8')
# 发送请求
s.send(request)
# 接受响应，并转换成 str 格式
response = s.recv(1024)
response = response.decode('utf-8')
```

3. 服务器端套路

```
host = ''
port = 2000
s = socket.socket()
s.bind((host, port))
while True:
    s.listen(5)
    connection, adress = s.accept()
    request = connection.recv(1024)
    response = b'HTTP/1.1 200 ok\r\n\r\n<h1>hhh</h1>''
    connection.sendall(response)
    connection.close()
```

## web 2: 改进的服务器套路（增加从请求中解析出路径，根据请求路径返回相应的响应内容）

1. 改进版服务器套路

```
with socket.socket() as s:
    s.bind((host, port))

    while True:
        s.listen(5)
        connection, address = s.accept()
        request = connection.recv(1024)
        request = request.decode('utf-8')
        try:
            # 服务器主要作用之一：解析请求的内容
            # 第一步解析出请求的 path，根据 path 返回相应的响应
            path = request.split()[1]
            response = response_for_path(path)
            connection.sendall(response)
        except Exception as e:
            log('error', e)
        connection.close()
```

2. 路径处理函数第一步，本质就是根据请求的 path 返回相应的内容
```
def response_for_path(path):
    r = {
        '/': route_index,
        '/doge.gif': route_image,
    }
    response = r.get(path, error)
    return response()
```

3. 路径处理函数第二步：具体的内容
>每个路径处理函数，不管是图片还是其他内容，都是由 **响应头部 + body** 组成。

## web 3: 继续改进服务器套路，成为简单的服务器框架。
